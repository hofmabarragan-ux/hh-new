---
import Layout from "../../layouts/BaseLayout.astro";
import PageHero from "../../components/PageHero.astro";
import CTA from "../../components/CTA.astro";
import ContactForm from "../../components/ContactForm.astro";

import { languages, type Lang, getContent } from "../../lib/i18n";
import { CONTACT } from "../../config/site";

export async function getStaticPaths() {
  return languages.map((lang) => ({ params: { lang } }));
}

type CardItem = { title: string; text: string };

const { lang } = Astro.params as { lang: Lang };
const content = getContent(lang) as any;

if (!content) throw new Error(`Idioma no soportado: ${lang}`);

/* ---------------- HERO (defensivo) ---------------- */
const title =
  content?.properties?.hero?.title ??
  (lang === "es" ? "Catálogo de Propiedades" : lang === "da" ? "Ejendomskatalog" : "Properties Catalogue");

const subtitle =
  content?.properties?.hero?.subtitle ??
  (lang === "es"
    ? "Propiedades seleccionadas y oportunidades para inversión en España. Estructura lista para crecer (filtros y fichas en fase siguiente)."
    : lang === "da"
      ? "Udvalgte ejendomme og investeringsmuligheder i Spanien. Strukturen er klar til at vokse (filtre og profiler i næste fase)."
      : "Curated properties and investment opportunities in Spain. Structure is ready to scale (filters and sheets in the next phase).");

/* ---------------- FILTERS (placeholder) ---------------- */
const filtersEyebrow =
  content?.properties?.filters?.eyebrow ?? (lang === "es" ? "FILTROS" : lang === "da" ? "FILTRE" : "FILTERS");

const filtersTitle =
  content?.properties?.filters?.title ??
  (lang === "es" ? "Filtra propiedades" : lang === "da" ? "Filtrér ejendomme" : "Filter properties");

const filtersSubtitle =
  content?.properties?.filters?.subtitle ??
  (lang === "es"
    ? "Los filtros avanzados se activarán en la siguiente fase."
    : lang === "da"
      ? "Avancerede filtre aktiveres i næste fase."
      : "Advanced filters will be enabled in the next phase.");

/* ---------------- CATALOGUE (placeholder) ---------------- */
const catalogueEyebrow =
  content?.properties?.catalogue?.eyebrow ??
  (lang === "es" ? "CATÁLOGO" : lang === "da" ? "KATALOG" : "CATALOGUE");

const catalogueTitle =
  content?.properties?.catalogue?.title ?? (lang === "es" ? "Propiedades" : lang === "da" ? "Ejendomme" : "Properties");

const intro2 =
  content?.properties?.intro2 ??
  (lang === "es"
    ? "Filtros estructurados, categorías y fichas detalladas se implementarán en la siguiente fase."
    : lang === "da"
      ? "Strukturerede filtre, kategorier og detaljerede ejendomsprofiler implementeres i næste fase."
      : "Structured filters, categories and detailed property sheets will be implemented in the next phase.");

/* Placeholder cards (defensivo) */
const placeholdersRaw = content?.properties?.placeholders;
const placeholdersFallback: CardItem[] =
  lang === "es"
    ? [
        { title: "Filtros avanzados", text: "Ubicación, rango de inversión, tipo de activo y estrategia." },
        { title: "Fichas detalladas", text: "Información estructurada para análisis comparativo." },
        { title: "Proceso guiado", text: "Acompañamiento estratégico desde la evaluación hasta el cierre." },
      ]
    : lang === "da"
      ? [
          { title: "Avancerede filtre", text: "Beliggenhed, investeringsinterval, aktivtype og strategi." },
          { title: "Detaljerede profiler", text: "Struktureret information til komparativ analyse." },
          { title: "Guidet proces", text: "Strategisk sparring fra evaluering til closing." },
        ]
      : [
          { title: "Advanced filters", text: "Location, investment range, asset type, and strategy." },
          { title: "Detailed sheets", text: "Structured information for comparative analysis." },
          { title: "Guided process", text: "Strategic guidance from evaluation to closing." },
        ];

const placeholders: CardItem[] =
  Array.isArray(placeholdersRaw) && placeholdersRaw.length ? (placeholdersRaw as CardItem[]) : placeholdersFallback;

/* ---------------- LINKS (defensivo) ---------------- */
const calendlyUrl = CONTACT?.calendlyUrl ?? CONTACT?.calendly ?? "#";
const hasCalendly = typeof calendlyUrl === "string" && calendlyUrl !== "#";
const calendlyTarget = hasCalendly ? "_blank" : undefined;
const calendlyRel = hasCalendly ? "noopener noreferrer" : undefined;

const phone = CONTACT?.phone ?? "";
const phoneHref = CONTACT?.phoneHref ?? (phone ? `tel:${phone}` : "#");

const whatsapp = CONTACT?.whatsapp ?? "";
const whatsappHref = CONTACT?.whatsappHref ?? (whatsapp ? `https://wa.me/${whatsapp.replace(/\D/g, "")}` : "#");

/* ---------------- SEO ---------------- */
const seo = {
  ...(content?.seo ?? {}),
  title,
  description: subtitle,
};

/* ---------------- CONTACT standard ---------------- */
const contactTitle = content?.global?.contact?.title ?? "Contact";
const contactSubtitle = content?.global?.contact?.subtitle ?? "Choose the fastest channel. We respond quickly.";

/* Contact form labels */
const formButton = content?.global?.form?.button ?? content?.global?.form?.submit ?? "Send message";
const nameLabel = content?.global?.form?.nameLabel ?? "Name";
const namePlaceholder = content?.global?.form?.namePlaceholder ?? "Name";
const emailLabel = content?.global?.form?.emailLabel ?? "Email";
const emailPlaceholder = content?.global?.form?.emailPlaceholder ?? "Email";
const messageLabel = content?.global?.form?.messageLabel ?? "Message";
const messagePlaceholder = content?.global?.form?.messagePlaceholder ?? "Message";

/* Readable labels (CTA row in content) */
const bookCallLabel =
  content?.global?.cta?.bookACall ?? (lang === "es" ? "Agendar llamada" : lang === "da" ? "Book møde" : "Book a call");
const whatsappLabel = content?.global?.cta?.whatsapp ?? "WhatsApp";
const callLabel = content?.global?.cta?.call ?? (lang === "es" ? "Llamar" : lang === "da" ? "Ring" : "Call");
---

<Layout lang={lang} seo={seo}>
  <!-- HERO (SIN CTAs fuera de Home) -->
  <PageHero title={title} subtitle={subtitle} />

  <main>
    <!-- FILTERS (placeholder) -->
    <section class="section section-tight">
      <div class="container">
        <header class="section-header section-header--center">
          <p class="eyebrow">{filtersEyebrow}</p>
          <h2 class="h2">{filtersTitle}</h2>
          {filtersSubtitle ? <p class="lead">{filtersSubtitle}</p> : null}
        </header>

        <div class="properties-filters" aria-label="Property filters placeholder">
          <div class="filter-pill">{lang === "es" ? "Ubicación" : lang === "da" ? "Beliggenhed" : "Location"}</div>
          <div class="filter-pill">
            {lang === "es" ? "Rango de inversión" : lang === "da" ? "Investeringsinterval" : "Investment range"}
          </div>
          <div class="filter-pill">{lang === "es" ? "Tipo de activo" : lang === "da" ? "Aktivtype" : "Asset type"}</div>
          <div class="filter-pill">{lang === "es" ? "Estrategia" : lang === "da" ? "Strategi" : "Strategy"}</div>
        </div>
      </div>
    </section>

    <!-- PROPERTIES (placeholder catalogue) -->
    <section class="section section-tight">
      <div class="container">
        <header class="section-header section-header--center">
          <p class="eyebrow">{catalogueEyebrow}</p>
          <h2 class="h2">{catalogueTitle}</h2>
          {intro2 ? <p class="lead">{intro2}</p> : null}
        </header>

        <div class="grid-3">
          {placeholders.map((item) => (
            <article class="card">
              <h3 class="h3">{item.title}</h3>
              <p class="text">{item.text}</p>
            </article>
          ))}
        </div>

        <!-- CTAs (en contenido, no en hero) -->
        <div class="cta-row" style="margin-top: 1.5rem;">
          <CTA label={bookCallLabel} href={calendlyUrl} target={calendlyTarget} rel={calendlyRel} />
          <CTA label={whatsappLabel} href={whatsappHref} />
          <CTA label={callLabel} href={phoneHref} />
        </div>
      </div>
    </section>

    <!-- CONTACT (standard + form, shared across pages) -->
    <section id="contact" class="section section-contact">
      <div class="container">
        <header class="section-header section-header--center">
          <h2 class="h2">{contactTitle}</h2>
          {contactSubtitle ? <p class="lead">{contactSubtitle}</p> : null}
        </header>

        <div class="contact-ctas">
          <CTA href={phoneHref} variant="icon" label={callLabel} icon="phone" />
          <CTA href={whatsappHref} variant="icon" label={whatsappLabel} icon="whatsapp" />
          <CTA
            href={calendlyUrl}
            variant="icon"
            label={bookCallLabel}
            icon="calendar"
            target={calendlyTarget}
            rel={calendlyRel}
          />
        </div>

        <div class="contact-form-wrap">
          <ContactForm
            button={formButton}
            nameLabel={nameLabel}
            namePlaceholder={namePlaceholder}
            emailLabel={emailLabel}
            emailPlaceholder={emailPlaceholder}
            messageLabel={messageLabel}
            messagePlaceholder={messagePlaceholder}
          />
        </div>
      </div>
    </section>
  </main>
</Layout>