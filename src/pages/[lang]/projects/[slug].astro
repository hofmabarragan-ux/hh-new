---
import Layout from "../../../layouts/BaseLayout.astro";
import { languages, getContent, type Lang } from "../../../lib/i18n";

/* REQUIRED for dynamic route */
export async function getStaticPaths() {
  return languages.flatMap((lang) => {
    const content = getContent(lang) as any;
    if (!content) return [];

    // Fuente principal: projects.items (coherente con /projects)
    const list = content.projects?.items ?? content.featuredProjects?.items ?? [];

    return list
      .filter((p: any) => p?.slug) // requiere slug para rutas estables
      .map((project: any) => ({
        params: {
          lang,
          slug: project.slug,
        },
      }));
  });
}

const { lang, slug } = Astro.params as { lang: Lang; slug: string };
const content = getContent(lang) as any;

if (!content) {
  throw new Error(`Idioma no soportado: ${lang}`);
}

// Busca primero en projects.items; fallback a featuredProjects.items
const list = content.projects?.items ?? content.featuredProjects?.items ?? [];
const project = list.find((p: any) => p.slug === slug);

if (!project) {
  throw new Error(`Proyecto no encontrado: ${lang}/${slug}`);
} 

---

<Layout lang={lang} seo={project.seo}>
  <section>
    <h1>{project.title}</h1>
    <p>{project.location}</p>
    <p>{project.text}</p>
  </section>
</Layout>
